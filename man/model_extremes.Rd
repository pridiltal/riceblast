% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/model_extremes.R
\name{model_extremes}
\alias{model_extremes}
\title{Model typical behaviour and Estimate Lower Extreme Threshold}
\usage{
model_extremes(
  typical_data = NULL,
  full_data = NULL,
  time_col,
  typical_start = NULL,
  typical_end = NULL,
  response,
  tail_prob = 0.05,
  t_method = c("evd", "boxplot")
)
}
\arguments{
\item{typical_data}{A tsibble containing the typical observation window for model fitting.
If provided, this dataset will be used instead of subsetting `full_data`.}

\item{full_data}{Optional tsibble object containing both typical observation window and
test data window. (ignored if `typical_data` is provided).}

\item{time_col}{Name of the time index column.}

\item{typical_start}{Optional Start date-time (character or POSIXct) defining the beginning
of the typical observation window used for model fitting. (ignored if `typical_data` is provided).}

\item{typical_end}{End date-time (character or POSIXct) defining the end
of the typical observation window. (ignored if `typical_data` is provided).}

\item{response}{The response variable to model, passed as an unquoted column name.}

\item{tail_prob}{Numeric value (default = 0.05). Tail probability used for defining
the lower extreme threshold when `t_method = "evd"`.}

\item{t_method}{Character string indicating the threshold estimation method.
Options are:
\itemize{
  \item `"evd"` — estimates the threshold using the Generalized Pareto Distribution.
  \item `"boxplot"` — uses the boxplot rule (1.5 × IQR below Q1) to identify lower extremes.
}}
}
\value{
A list containing:
\describe{
  \item{model}{The fitted ARIMA model object.}
  \item{lower_limit}{The estimated lower extreme threshold.}
  \item{threshold_method}{The threshold estimation method used (`"evd"` or `"boxplot"`).}
  \item{typical_data}{The subset of the time series used for model fitting.}
  \item{response}{The response variable name.}
  \item{time_col}{Name of the time index column.}
}
}
\description{
Fits an ARIMA model on a subset of the time series representing "typical" behavior
and estimates a lower extreme threshold based on either Extreme Value Theory (EVT)
using the Generalized Pareto Distribution (GPD) or a boxplot-based approach.
}
\details{
The function first subsets the input time series between `typical_start` and `typical_end`
to capture non-extreme, representative behavior. An ARIMA model is automatically fitted
using the `fable` framework, and residuals are extracted.

Depending on the chosen `t_method`, the lower extreme threshold is estimated:
\itemize{
  \item For `"evd"` — the Generalized Pareto Distribution is fitted to the lower tail
        of residuals using \code{fpot()} from the \pkg{evd} package.
  \item For `"boxplot"` — the lower whisker (Q1 − 1.5 × IQR) is used as the threshold.
}
}
\examples{
# Create a sample daily time series dataset (use Date, not POSIXct)
data <- tsibble::tsibble(
  date = seq.Date(as.Date("2020-01-01"), as.Date("2020-12-31"), by = "day"),
  value = c(rnorm(300),rnorm(66, -3)),
  index = date
)

# Run the model_extremes function
result <- model_extremes(
  full_data = data,
  time_col = date,
  typical_start = "2020-01-01",
  typical_end = "2020-08-30",
  response = value,
  tail_prob = 0.1,
  t_method = "boxplot"
)

}
