---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# cropguard <img src="man/figures/logo.png" align="right" height="200" width="200" />

[![Project Status: WIP – Initial development is in progress, but there has not yet been a stable, usable release suitable for the public.](https://www.repostatus.org/badges/latest/wip.svg)](https://www.repostatus.org/#wip)
[![Licence](https://img.shields.io/badge/licence-GPL--3-blue.svg)](https://www.gnu.org/licenses/old-licenses/gpl-3.0.html)
[![minimal R version](https://img.shields.io/badge/R%3E%3D-4.1.0-6666ff.svg)](https://cran.r-project.org/)
[![packageversion](https://img.shields.io/badge/Package%20version-0.1.0-orange.svg?style=flat-square)](commits/master)
 
---
 
[![Last-changedate](https://img.shields.io/badge/last%20change-`r gsub('-', '--', Sys.Date())`-yellowgreen.svg)](/commits/master)


The goal of the `cropguard` R package is to provide data and tools for forecasting
rice blast disease outbreaks using weather-based parameters. It combines
climate variables (such as temperature, humidity, and rainfall) with
knowledge of disease development to build predictive models and early
warning systems. the `cropguard` package implements a tool for accurate and timely disease forecasting based on realtime weather data. The package helps researchers, agronomists, and
policymakers understand and anticipate disease risks, supporting
sustainable management strategies to reduce crop losses and improve food
security. This platform fosters a supportive network of plant pathogen surveillance stakeholders, working together to advance agricultural health.

## Installation

You can install the development version of cropguard from [GitHub](https://github.com/pridiltal/cropguard) with:

``` r
# install.packages("pak")
pak::pak("pridiltal/cropguard")
```

## Proposed framework

The following figure summarizes the proposed framework for climate-based blast disease monitoring, comprising two primary phases: an off-line phase and an on-line phase. In the off-line phase, historical climate data characterizing typical behaviour are preprocessed, and an automated model selection procedure is employed to identify the optimal univariate model for a given dataset, which are subsequently fitted to the data. Residuals from these models are then analyzed to estimate field-specific anomalous thresholds using Extreme Value Theory (EVT), providing reference points for the detection of potential disease outbreaks. In the on-line phase, incoming real time climate data from the test window undergoes preprocessing and forecast generation. Forecast errors are evaluated against the previously determined anomalous thresholds to classify observations as either typical or indicative of a blast alert. This two-phase approach enables both data-driven model calibration and real-time disease risk assessment.

<img src="man/figures/framework.png" width="850"/>

## Example


This is an example dataset available in the `cropguard` package. For more examples, please refer to the package vignettes.


```{r example, message = FALSE, warning = FALSE}
library(cropguard)
head(field1)
```


The following example demonstrates the detection of unusually low or high values (lower or upper extremes) in a daily time series, using a synthetic dataset processed through the `CropGuard` workflow. We first fit a model on an initial “typical” period to estimate the lower and upper extreme thresholds and then test whether future observations fall outside those thresholds. The generated plots visualize both the detected extremes and the corresponding forecast errors.

```{r}
# Create a sample daily time series dataset with a gradual level shift
base_vals <- rnorm(300)
gradual_shift <- seq(from = 0, to = -3, length.out = 66)
vals <- c(base_vals, rnorm(66) + gradual_shift)

data <- tsibble::tsibble(
  date = seq.Date(as.Date("2020-01-01"), as.Date("2020-12-31"), by = "day"),
  value = vals,
  index = date
)


# Fit the model to estimate the lower extreme threshold using a “typical” period
result <- model_extremes_uni(
  full_data = data,
  time_col = date,
  typical_start = "2020-01-01",
  typical_end = "2020-08-30",
  response = value,
  thr_prob_fit = 0.1,
  t_method = "evd",
  k=0
)

# Prepare a test dataset
test_data <- data |>
  dplyr::filter(date > as.Date("2020-06-30")) |>
  dplyr::select(date, value) |>
  tsibble::as_tsibble(index = date)

# Evaluate future values against the learned extreme threshold
test_result <- cropguard::test_extremes_uni(result, test_data = test_data, h = 200)

# # Generate and view plots for extremes and errors
plots <- plot_extreme_analysis_uni(test_result)

# Visualize future forecasts relative to the typical historical behaviour
plots$main_plot

# Visualize detected extremes using the residual and forecast error plots
plots$error_plot
```


## Funding

This R package was developed under the interdisciplinary project titled “Weather-based Blast Disease Forecasting and Early Warning Systems for Climate Risk Adaptation”, funded through the National Agricultural Research Plan (NARP) initiative of the Sri Lanka Council for Agricultural Research Policy (SLCARP) -2024.

## Project team members

Priyanga Dilini Talagala, Department of Computational Mathematics, University of Moratuwa. Lead developer of the R package.

Mahlon Pragath Rambukkange, Department of Geography, University of Peradeniya

Sachith P. Abesundara, Department of Statistics and Computer Science, University of Peradeniya

Isuru Madugalla, Department of Statistics & Computer Science, University of Peradeniya.

Shashika Weerakoon, Postgraduate Institute of Science, University of Peradeniya

H.N.S. Fernando, Rice Reaserch and Development Institute, Batalagoda

Dulakshi Pabasara, Department of Botany, University of Peradeniya

Chandima Ariyarathna, Department of Botany, University of Peradeniya: Rice breeder by training. Principle investigator of the project. Conceptualizing the overall project, acquiring funding, and project coordination

